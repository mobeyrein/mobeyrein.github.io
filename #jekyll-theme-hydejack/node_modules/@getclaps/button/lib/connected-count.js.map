{"version":3,"file":"connected-count.js","sourceRoot":"","sources":["../src/connected-count.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,aAAa,CAAC;AAEzC,MAAM,WAAW,GAAG,IAAI,GAAG,EAAe,CAAC;AAE3C,MAAM,OAAO,qBAAsB,SAAQ,UAAU;IAArD;;QAIE,uBAAW;IAwBb,CAAC;IA3BC,IAAI,iBAAiB,KAAyB,OAAO,SAAS,CAAA,CAAC,CAAC;IAAA,CAAC;IAEvD,uBAAuB,KAAI,CAAC;IAAA,CAAC;IAGvC,iBAAiB;;QACf,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAE1B,uBAAA,IAAI,cAAQ,IAAI,CAAC,iBAAiB,mCAAI,IAAI,EAAC;QAE3C,WAAW,CAAC,GAAG,qCAEb,CAAC,GAAG,CAAC,WAAW,CAAC,GAAG,oCAAW,IAAI,CAAC,CAAC,CACtC,CAAC;IACJ,CAAC;IAED,oBAAoB;;QAClB,KAAK,CAAC,oBAAoB,EAAE,CAAC;QAE7B,MAAM,QAAQ,GAAG,CAAC,CAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,GAAG,yCAAe,CAAC,CAAC,GAAG,CAAC,CAAC;QACxD,IAAI,QAAQ,GAAG,CAAC,EAAE;YAChB,WAAW,CAAC,GAAG,qCAAY,QAAQ,CAAC,CAAC;SACtC;aAAM;YACL,WAAW,CAAC,MAAM,oCAAW,CAAC;YAC9B,MAAA,IAAI,CAAC,uBAAuB,+CAA5B,IAAI,EAA6B;SAClC;IACH,CAAC;CACF","sourcesContent":["import { LitElement } from \"lit-element\";\n\nconst refCountMap = new Map<any, number>();\n\nexport class ConnectedCountElement extends LitElement  {\n  get connectedCountKey(): string | undefined { return undefined };\n\n  protected allDisconnectedCallback() {};\n  #ref!: any;\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    this.#ref = this.connectedCountKey ?? this;\n\n    refCountMap.set(\n      this.#ref, \n      1 + (refCountMap.get(this.#ref) || 0),\n    );\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n\n    const refCount = (refCountMap?.get(this.#ref) || 0) - 1;\n    if (refCount > 0) {\n      refCountMap.set(this.#ref, refCount);\n    } else {\n      refCountMap.delete(this.#ref);\n      this.allDisconnectedCallback?.();\n    }\n  }\n}\n"]}