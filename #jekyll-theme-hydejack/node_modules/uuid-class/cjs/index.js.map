{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { bufferSourceToUint8Array, bytesToHexArray, concatUint8Arrays, hexStringToBytes } from 'typed-array-utils';\n\nfunction _bytesToUUIDString(uint8Array: Uint8Array) {\n  const hexArray = bytesToHexArray(uint8Array);\n  hexArray.splice(4, 0, '-');\n  hexArray.splice(7, 0, '-');\n  hexArray.splice(10, 0, '-');\n  hexArray.splice(13, 0, '-');\n  return hexArray.join('');\n}\n\nfunction _v4() {\n  const uuid = crypto.getRandomValues(new Uint8Array(16));\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  uuid[6] = (uuid[6] & 0x0f) | 0x40;\n  uuid[8] = (uuid[8] & 0x3f) | 0x80;\n\n  return uuid.buffer;\n}\n\nfunction _fromString(str: string) {\n  const hex = str.replace(/[^0-9a-f]/gi, '').slice(0, 32);\n  if (hex.length < 32) throw Error('UUID too short');\n  return hexStringToBytes(hex).buffer;\n}\n\nfunction stringToBytes(str: string) {\n  str = unescape(encodeURIComponent(str)); // UTF8 escape\n  return new TextEncoder().encode(str);\n}\n\nasync function _v5(value: string | BufferSource, namespace: string | UUID) {\n  const valueBytes = typeof value === 'string'\n    ? stringToBytes(value)\n    : bufferSourceToUint8Array(value);\n\n  const namespaceUUID = typeof namespace === 'string'\n    ? new UUID(namespace)\n    : namespace\n\n  const hashBytes = new Uint8Array(\n    await crypto.subtle.digest('SHA-1', concatUint8Arrays(namespaceUUID, valueBytes))\n  );\n\n  hashBytes[6] = (hashBytes[6] & 0x0f) | 0x50; // version\n  hashBytes[8] = (hashBytes[8] & 0x3f) | 0x80;\n\n  return hashBytes.buffer.slice(0, 16);\n}\n\n/**\n * A better UUID class for JavaScript.\n * \n * UUID are represented as bytes (`Uint8Array`) and converted to strings on-demand.\n * \n * This class implements `toString` and `toJSON` for better language integration,\n * as well as inspection for node and Deno for a better development experience.\n * \n * For the most part, `UUID` can be used where  UUID strings are used,\n * except for equality checks. For those cases, `UUID` provides quick access \n * to the string representations via the `id` field.\n */\nexport class UUID extends Uint8Array {\n  /**\n   * Generate a new UUID version 4 (random).\n   * \n   * __Note that `crypto.getRandomValues` needs to be available in the global JS object!__\n   */\n  static v4() {\n    return new UUID(_v4());\n  }\n\n  /**\n   * Generated a new UUID version 5 (hashed)\n   * \n   * __Note that `crypto.subtle` needs to be available in the global JS object (Not the case on non-HTTPS sites)!__\n   * \n   * @param value \n   * @param namespace \n   */\n  static async v5(value: string | BufferSource, namespace: string | UUID) {\n    return new UUID(await _v5(value, namespace));\n  }\n\n  /**\n   * Generate a new UUID version 4 (random).\n   * __Note that `crypto.getRandomValues` needs to be available in the global JS object!__\n   */\n  constructor();\n  /** Creates a new UUID object from the provided string, which must be a valid UUID string. */\n  constructor(value: string);\n  /** Creates a copy of the provided UUID */\n  constructor(value: UUID);\n  /** Create a UUID from the provided iterable, where every value will be interpreted as a unsigned 8 bit integer. */\n  constructor(value: Iterable<number>);\n  /** Create a new UUID from the provided array-like structure. */\n  constructor(value: ArrayLike<number> | ArrayBufferLike);\n  /** Creates a UUID from the array buffer using 16 bytes started from the provided offset. */\n  constructor(value: ArrayBufferLike, byteOffset: number);\n  constructor(value?: string | UUID | Iterable<number> | ArrayLike<number> | ArrayBufferLike, byteOffset?: number) {\n    if (value == null) {\n      super(_v4());\n    } else if (typeof value === 'string') {\n      super(_fromString(value));\n    } else if (value instanceof UUID) {\n      super(value.buffer.slice(0));\n    } else {\n      const u8 = value instanceof ArrayBuffer || value instanceof SharedArrayBuffer \n        ? new Uint8Array(value, byteOffset ?? 0, 16)\n        : 'length' in value ? new Uint8Array(value) : new Uint8Array(value);\n      if (u8.length < 16) throw Error('UUID too short');\n      super(u8.buffer.slice(0, 16));\n    }\n  }\n\n  /**\n   * Quick access to the string representation for easier comparison.\n   * @example if (myUUID.id === otherUUID.id) { ... }\n   */\n  get id() {\n    return _bytesToUUIDString(this);\n  }\n\n  /**\n   * Quick access to the UUID string representation for easier comparison.\n   * @example if (myUUID.uuid === otherUUID.uuid) { ... }\n   */\n  get uuid() {\n    return _bytesToUUIDString(this);\n  }\n\n  toString() {\n    return _bytesToUUIDString(this);\n  }\n\n  toJSON() {\n    return _bytesToUUIDString(this);\n  }\n\n  // We don't operations like `map`, `subarray`, etc. to preserve the UUID class status\n  static get [Symbol.species]() { return Uint8Array }\n}\n\n// Better inspection for node and deno:\nconst nodeInspect = Symbol.for('nodejs.util.inspect.custom');\n\n// @ts-ignore\nconst denoInspect: symbol = typeof Deno !== 'undefined'\n  // @ts-ignore\n  ? 'symbols' in Deno ? Deno.symbols.customInspect : Deno.customInspect\n  : Symbol();\n\n// @ts-ignore\nUUID.prototype[nodeInspect] = function () { return `UUID [ ${this.uuid} ]` }\n\n// @ts-ignore\nUUID.prototype[denoInspect] = function () { return `UUID [ ${this.uuid} ]` }\n"]}